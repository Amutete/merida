<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MERIDA - Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet" />
  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-slate-200">

  <!-- Login Section -->
  <div id="admin-login-container" class="min-h-screen flex items-center justify-center">
    <div class="w-full max-w-sm bg-white rounded-2xl shadow-xl p-8">
      <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">MERIDA Admin</h1>
      <div id="admin-error-message" class="mb-4 text-center text-red-500 font-medium h-5"></div>
      <form id="admin-login-form">
        <div class="mb-4">
          <label for="admin-email" class="block text-sm font-medium text-gray-700">Admin Email</label>
          <input type="email" id="admin-email" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" />
        </div>
        <div class="mb-6">
          <label for="admin-password" class="block text-sm font-medium text-gray-700">Admin Password</label>
          <input type="password" id="admin-password" required class="mt-1 block w-full px-3 py-2 bg-slate-50 border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" />
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300 shadow-lg">Login</button>
      </form>
    </div>
  </div>

  <!-- Claim Section -->
  <div id="claim-container" class="hidden min-h-screen items-center justify-center bg-slate-200 p-4" style="display: none;">
    <div class="w-full max-w-lg bg-white rounded-2xl shadow-xl p-8 text-center">
      <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4" role="alert">
        <p class="font-bold text-lg">Admin Account Setup</p>
        <p class="mt-2">Click the button below to grant admin privileges to this account. This is a one-time step.</p>
        <button id="grant-admin-btn" class="mt-4 bg-green-600 text-white font-bold py-2 px-6 rounded hover:bg-green-700 transition-colors">Grant Privileges</button>
      </div>
      <button id="claim-logout-btn" class="mt-6 text-sm text-slate-500 hover:underline">Logout</button>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel-container" class="hidden container mx-auto p-4 md:p-8">
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-4xl font-bold text-slate-800">MERIDA Admin Panel</h1>
      <button id="admin-logout-btn" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600">Logout</button>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div>
        <h2 class="text-2xl font-bold text-slate-700 mb-4">Withdrawal Requests</h2>
        <div id="notifications-list" class="space-y-4 bg-white p-4 rounded-lg shadow max-h-96 overflow-y-auto"></div>
      </div>
      <div>
        <h2 class="text-2xl font-bold text-slate-700 mb-4">All Users</h2>
        <div id="users-list" class="space-y-4 bg-white p-4 rounded-lg shadow max-h-96 overflow-y-auto"></div>
      </div>
    </div>
  </div>

  <!-- User Modal -->
  <div id="user-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-40 p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md text-slate-800">
      <h3 id="modal-username" class="font-bold text-xl mb-4">User Details</h3>
      <div class="space-y-3">
        <div>
          <label for="modal-level" class="block text-sm font-medium text-slate-700">Set Investment Level</label>
          <select id="modal-level" class="mt-1 block w-full p-2 bg-slate-50 border border-slate-300 rounded-md"></select>
        </div>
        <p class="text-xs text-slate-500">Updating the level will activate the user's account.</p>
        <button id="update-user-btn" class="w-full bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700">Update User</button>
      </div>
      <button id="close-user-modal-btn" class="mt-4 w-full text-center text-slate-600 font-semibold">Close</button>
    </div>
  </div>

  <!-- Firebase and Admin Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, doc, updateDoc, onSnapshot, query, orderBy, deleteDoc, getDoc, addDoc, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-functions.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB8Ni8HRr5lbtvD3WDcly9xTAdAl2OKNNQ",
      authDomain: "merida-47818.firebaseapp.com",
      projectId: "merida-47818",
      storageBucket: "merida-47818.appspot.com",
      messagingSenderId: "606896191722",
      appId: "1:606896191722:web:bf309888bd1cfbb6123f93",
      measurementId: "G-SPSG3DYMY7"
    };

    const ADMIN_EMAIL = "cleophasamutete@gmail.com";
    const INVESTMENT_LEVELS = {
      'level-1': { name: 'Level 1 (Ksh 500)' },
      'level-2': { name: 'Level 2 (Ksh 1,000)' },
      'level-3': { name: 'Level 3 (Ksh 2,000)' },
      'level-4': { name: 'Level 4 (Ksh 3,000)' },
      'level-5': { name: 'Level 5 (Ksh 5,000)' },
      'level-6': { name: 'Level 6 (Ksh 10,000)' },
      'None': { name: 'No Level' }
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const functions = getFunctions(app);

    // DOM and event handling goes here (unchanged from your original code)
    // ...
    // You can paste the event handling and logic code from your original file here
    // to avoid duplication. Let me know if you want me to paste the full logic again.
  </script>
</body>
</html>
